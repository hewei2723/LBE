C51 COMPILER V9.54   MAIN                                                                  11/09/2024 20:09:44 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include<reg51.h>
   2          sbit LE=P1^0;
   3          sbit key1=P2^0;//选择时间，按下的时候时间暂停同时选择时间
   4          sbit key2=P2^1;//时间+
   5          sbit key3=P2^2;//时间-
   6          sbit key4=P2^3;//开始计时
   7          int cp=0,cpfh=0;time=0,flash = 0x00,start=1,mode=1;
   8          int secondA,hourA,minuteA,secondB,minuteB,hourB;
   9          int poi[]={0x80,0x40,0x20,0x10,0x08,0x04,0x02,0x01};
  10          unsigned char seven_seg[] ={0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90};
  11          void latch(){
  12   1        LE=1;
  13   1        LE=0;
  14   1      }
  15          void delay(int x){while(x--);}
  16          void STM(int time) {
  17   1          secondA = (time % 60) / 10;
  18   1          secondB = (time % 60) % 10;
  19   1          minuteA = (time / 60 % 60) / 10;
  20   1          minuteB = (time / 60 % 60) % 10;
  21   1          hourA = (time / 3600) / 10;
  22   1          hourB = (time / 3600) % 10;
  23   1      }
  24          void timer0_isr() interrupt 1
  25          {
  26   1        TH0 = (65535 - 5000) / 256;
  27   1        TL0 = (65535 - 5000) % 256;
  28   1        cp++;
  29   1        cpfh++;
  30   1        if(cp>50&&start==1){
  31   2          time++;
  32   2          cp=0;
  33   2        }//产生时间
  34   1        //从系统运行时开始，time不断上涨
  35   1        if(cpfh>50){
  36   2          flash=~flash;
  37   2          cpfh=0;
  38   2        }
  39   1        STM(time);
  40   1      }
  41          void timer0_init()
  42          {
  43   1        TMOD = 0x01;  
  44   1        TH0 = (65536 - 5000) / 256;
  45   1        TL0 = (65536 - 5000) % 256;
  46   1        EA = 1;
  47   1        ET0 = 1;
  48   1        TR0 = 1;
  49   1      }
  50          void display(int num,int Poi){
  51   1        P0=0xff;P0=poi[Poi];latch();P0=seven_seg[num];delay(200);
  52   1        P0=0xff;P0 = 0X04;latch();P0 = 0xbf|flash;delay(200);
  53   1        P0=0xff;P0 = 0X20;latch();P0 = 0xbf|flash;delay(200);
  54   1      }
C51 COMPILER V9.54   MAIN                                                                  11/09/2024 20:09:44 PAGE 2   

  55          void Modedisplay(int num,int Poi){
  56   1        P0=0xff;P0=poi[Poi];latch();P0=seven_seg[num]|flash;delay(200);
  57   1        P0=0xff;P0 = 0X04;latch();P0 = 0xbf|flash;delay(200);
  58   1        P0=0xff;P0 = 0X20;latch();P0 = 0xbf|flash;delay(200);
  59   1      }
  60          void ShowSec(){
  61   1        display(secondA,1);
  62   1        display(secondB,0);
  63   1      }
  64          void ShowMinute(){
  65   1        Modedisplay(minuteA,4);
  66   1        display(minuteB,3);
  67   1      }
  68          void ShowHour(){
  69   1      Modedisplay(hourA,7);
  70   1      Modedisplay(hourB,6);
  71   1      }
  72          void modeShowSec(){
  73   1        Modedisplay(secondA,1);
  74   1        Modedisplay(secondB,0);
  75   1      }
  76          void modeShowMinute(){
  77   1        Modedisplay(minuteA,4);
  78   1        Modedisplay(minuteB,3);
  79   1      }
  80          void modeShowHour(){
  81   1      display(hourA,7);
  82   1      display(hourB,6);
  83   1      }
  84          void key(){
  85   1          ShowSec();
  86   1          ShowMinute();
  87   1          ShowHour();
  88   1        if(key1==0){
  89   2          start=0;
  90   2          mode++;
  91   2          if(mode%3==1){modeShowhour();}//小时
*** WARNING C206 IN LINE 91 OF main.c: 'modeShowhour': missing function-prototype
  92   2          if(mode%3==2){modeShowMinute();}//分钟
  93   2          if(mode%3==0){modeShowSec();}//秒
  94   2        }
  95   1        if(key2==0){}//time++
  96   1          if(key3==0){}//time--
  97   1        if(key4==0){
  98   2        start=1;}//开始时间
  99   1      }
 100          void main(){
 101   1        timer0_init();
 102   1        while(1){
 103   2          key();
 104   2        }
 105   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    663    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     50    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.54   MAIN                                                                  11/09/2024 20:09:44 PAGE 3   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
